set nocompatible
set encoding=utf-8
set mouse=a

set termguicolors
colorscheme catppuccin_mocha

set laststatus=2
set showtabline=2
set signcolumn=yes

" Styling
syntax on
set showmatch
set number
set relativenumber
set cursorline
set scrolloff=8
set nowrap

" Indenting
set tabstop=4
set shiftwidth=4
set softtabstop=4
set expandtab
set smartindent
set autoindent

" Searching
set incsearch
set hlsearch
set ignorecase
set smartcase

" Searching system for files 
set wildmenu
set wildignore+=**/.git/**,**/venv/**,**/vendor/**,**/__pycache__/**
set path+=**
nnoremap <leader>f :find 

" Change keybinding for getting out of modes 
inoremap kj <esc>
vnoremap kj <esc>

" Change keybinding for switching through open buffers
nnoremap <Tab> :bnext<CR>
nnoremap <S-Tab> :bprevious<CR>

" Change keybindings for navigating splits
nnoremap <C-h> <C-W>h
nnoremap <C-j> <C-W>j
nnoremap <C-k> <C-W>k
nnoremap <C-l> <C-W>l

" Omnicompletion
filetype plugin on
set completeopt=menu,menuone,noselect

inoremap <expr> <C-n> pumvisible() ? "\<C-n>" : "\<C-x>\<C-o>"
inoremap <expr> <CR> pumvisible() ? "\<C-y>" : "\<CR>"

" Netrw configs
let g:netrw_liststyle=3 " Tree View
let g:netrw_preview=1 " Open previews in vertical split
let g:netrw_alto=0 " Open preview in vertical split
let g:netrw_altv=1 " Open vertical splits to right of current buffer
let g:netrw_keepdir=0 " Use vim CWD

nnoremap <Leader>e :Explore .<CR>

" Minimal fuzzy finding in source code
function! SearchAllFiles(query)
    if empty(a:query)
        echo "No search query provided."
        return
    endif

    execute 'vimgrep /' . escape(a:query, '/\') . '/j **/*'

    if len(getqflist()) > 0
        copen
    else
        echo "No matches found for: " . a:query
    endif
endfunction

nnoremap <leader>g :call SearchAllFiles(input('Search for: '))<CR>
autocmd FileType qf nnoremap <buffer> <CR> <CR>zz:cclose<CR>

" Setup cold folding. Use space bar to fold. Folds should save when closing buffer
set foldmethod=indent
set foldlevel=99
nnoremap <space> za

augroup remember_folds
    autocmd!
    autocmd BufWinLeave * if &buftype == '' && &filetype != 'qf' | mkview | endif
    autocmd BufWinEnter * if &buftype == '' && &filetype != 'qf' | silent! loadview | endif
augroup END

" Pull in my other vim files
source ~/Documents/repos/dotfiles/vim/git_magic.vim
source ~/Documents/repos/dotfiles/vim/status_line.vim
